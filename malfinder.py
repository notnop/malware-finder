import urllib2
import re
import sys

useragent = {'User-Agent': "lynx"}
found = []


# search sample
def vxvault(md5_hash):
    address = "http://vxvault.net/ViriList.php?s=0&m=40&MD5=" + str(md5_hash)
    try:
        req = urllib2.Request(address, None, useragent)
        html = urllib2.urlopen(req).read()

    except Exception as e:
        print e

    # find all malware address
    pagina = html.split("\r")
    for i in pagina:
        match = re.search("href='ViriFiche\.php\?ID=[\d]+'>(.+)</a></TD>", i)
        if match:
            temp_mal_address = match.group(1)
            if not re.search("[\d]{1,2}-[\d]{1,2}", temp_mal_address):
                # add malware address
                found.append(temp_mal_address)
                print "here is something for you: ", temp_mal_address


if len(sys.argv) < 2:
    sys.exit("What do you wanna search?\nTry: script_name.py md5_hash")
if len(sys.argv[1]) != 32:
    print "Are you sure that %s is a MD5 hash?" % sys.argv[1]
    sys.exit("Try again")


vxvault(sys.argv[1])


if len(found) > 0:
    print "Downloading \n"
    for i in found:
        if i[:7] != "http://":
            i = "http://" + i
        try:
            req = urllib2.Request(i, None, useragent)
            u = urllib2.urlopen(req, timeout=59).read()

            # write to file
            f = open(sys.argv[1], 'wb')
            f.write(u)
            f.close()
            print "Done, your sample is safe"
            sys.exit()
        except Exception as x:
            print x

else:
    print "Nothing for you sorry"
